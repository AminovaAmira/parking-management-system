# Русские сообщения об ошибках API

## Что было сделано

Реализована централизованная система обработки ошибок на русском языке для всего API.

### Изменения в коде:

1. **Создан файл `app/core/exceptions.py`**
   - Кастомные обработчики исключений
   - Словари для перевода полей и типов ошибок
   - Форматирование ошибок валидации на русском

2. **Обновлен `app/main.py`**
   - Подключены кастомные exception handlers
   - Все ошибки теперь обрабатываются централизованно

3. **Обновлены endpoint'ы**
   - `app/api/endpoints/auth.py` - русские сообщения
   - `app/core/dependencies.py` - русские сообщения

## Примеры ошибок

### 1. Ошибка аутентификации (401)

**Запрос:**
```bash
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"wrong@test.com","password":"wrongpass"}'
```

**Ответ:**
```json
{
    "error": true,
    "message": "Неверный email или пароль",
    "status_code": 401
}
```

### 2. Дублирование email (400)

**Запрос:**
```bash
curl -X POST http://localhost:8000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"amira@test.com","password":"Pass1234","first_name":"Test","last_name":"User","phone":"+79999999999"}'
```

**Ответ:**
```json
{
    "error": true,
    "message": "Пользователь с таким email уже зарегистрирован",
    "status_code": 400
}
```

### 3. Ошибки валидации (422)

**Запрос с пустыми полями:**
```bash
curl -X POST http://localhost:8000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"","password":"123","first_name":"Test"}'
```

**Ответ:**
```json
{
    "error": true,
    "message": "Обнаружено ошибок валидации: 4",
    "errors": [
        {
            "field": "Фамилия",
            "message": "Фамилия: Поле обязательно для заполнения",
            "type": "missing"
        },
        {
            "field": "Email",
            "message": "Email: Неверный формат данных",
            "type": "value_error"
        },
        {
            "field": "Телефон",
            "message": "Телефон: Поле обязательно для заполнения",
            "type": "missing"
        },
        {
            "field": "Пароль",
            "message": "Пароль: Минимальная длина 6 символов",
            "type": "string_too_short"
        }
    ],
    "status_code": 422
}
```

### 4. Недостаточно прав (403)

**Ответ:**
```json
{
    "error": true,
    "message": "Недостаточно прав. Требуется доступ администратора.",
    "status_code": 403
}
```

### 5. Неверный токен (401)

**Ответ:**
```json
{
    "error": true,
    "message": "Не удалось проверить учетные данные",
    "status_code": 401
}
```

### 6. Ресурс не найден (404)

**Ответ:**
```json
{
    "error": true,
    "message": "Ресурс не найден",
    "status_code": 404
}
```

### 7. Внутренняя ошибка сервера (500)

**Ответ:**
```json
{
    "error": true,
    "message": "Произошла внутренняя ошибка сервера. Попробуйте позже.",
    "status_code": 500
}
```

## Структура ответа с ошибкой

Все ошибки возвращаются в едином формате:

```json
{
    "error": true,
    "message": "Основное сообщение об ошибке",
    "status_code": 400,
    "errors": [...]  // Опционально, для ошибок валидации
}
```

## Переведенные поля

Список полей с русскими названиями:

- `email` → Email
- `password` → Пароль
- `first_name` → Имя
- `last_name` → Фамилия
- `phone` → Телефон
- `license_plate` → Номер автомобиля
- `make` → Марка
- `model` → Модель
- `color` → Цвет
- `vehicle_type` → Тип автомобиля
- `spot_id` → ID парковочного места
- `vehicle_id` → ID автомобиля
- `zone_id` → ID зоны
- `start_time` → Время начала
- `end_time` → Время окончания
- `amount` → Сумма
- `payment_method` → Метод оплаты
- `current_password` → Текущий пароль
- `new_password` → Новый пароль

## Как добавить новые переводы

### Добавить перевод поля:

Отредактировать `app/core/exceptions.py`:

```python
FIELD_TRANSLATIONS = {
    "новое_поле": "Новое поле на русском",
    # ...
}
```

### Добавить кастомное сообщение об ошибке:

В любом endpoint:

```python
from fastapi import HTTPException, status

raise HTTPException(
    status_code=status.HTTP_400_BAD_REQUEST,
    detail="Ваше русское сообщение об ошибке"
)
```

Обработчик автоматически определит, что сообщение уже на русском (содержит кириллицу) и не будет его переводить.

## Преимущества такого подхода

1. **Централизованность** - все ошибки обрабатываются в одном месте
2. **Консистентность** - одинаковый формат для всех ошибок
3. **Простота** - легко добавлять новые переводы
4. **Автоматическая обработка** - FastAPI автоматически использует наши handlers
5. **Локализация** - можно легко добавить поддержку других языков

## Тестирование

Запустите backend и выполните тестовые запросы из примеров выше, чтобы убедиться, что все ошибки возвращаются на русском языке.
